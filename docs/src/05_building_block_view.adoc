ifndef::imagesdir[:imagesdir: ../images]

[[section-building-block-view]]
== Building Block View

=== Level 1: White Box of the Overall System

The building block view shows the static decomposition of the system into building blocks and their dependencies.

**Motivation:**
Decomposing the system into separate components (Webapp, Backend, and Database) allows us to handle user interface, game logic, and data persistence independently, using the best technology for each (React, Rust/Node.js, and MongoDB).

**Contained Building Blocks:**

[plantuml, "level-1-diagram", svg]
----
node "User" as user
node "WIQ System" {
    component [React Webapp] as webapp
    component [Node.js/Rust Backend] as backend
    database [MongoDB] as db
}
user -> webapp : Plays Game Y
webapp -> backend : API Requests
backend -> db : Persists Data
----

[cols="1,2" options="header"]
|===
| **Name** | **Responsibility**
| React Webapp | Provides the user interface for playing Game Y and user registration.
| Backend Services | Coordinates game logic, authentication, and service communication.
| MongoDB | **(Database)** Acts as the primary NoSQL data store for user profiles and history.
|===
==== React Webapp
**Purpose/Responsibility:**
Provides the user interface for playing Game Y, handling user registration, and displaying real-time game updates.

**Interface(s):**
* **Web UI:** React-based frontend accessible via browser.
* **API Consumer:** Communicates with Backend Services via REST/JSON.

**Directory/File Location:**
`./apps/webapp`

==== Backend Services
**Purpose/Responsibility:**
Acts as the central orchestrator. It manages authentication, coordinates game logic between the engine and the user, and handles data persistence.

**Interface(s):**
* **REST API:** Provides endpoints for login, game actions, and stats.
* **Engine Connector:** Internal communication with the Rust Game Engine.

**Directory/File Location:**
`./apps/backend`

==== MongoDB
**Purpose/Responsibility:**
Stores persistent data including user credentials, match history, and global rankings.

**Directory/File Location:**
`./data/db`
**Important Interfaces:**
* **REST API:** Communication between frontend and backend via JSON.
* **Database Connection:** Backend access to MongoDB on port 27017.

---

=== Level 2: White Box of the Backend Services

This level zooms into the Backend to show how it is decomposed into specialized microservices.

[plantuml, "level-2-diagram", svg]
----
package "Backend Services" {
    component [Auth Service] as auth
    component [Game Service] as game
    component [User Statistics] as stats
}
database "MongoDB" as db

auth -> db : User credentials
game -> db : Game Y state (YEN)
stats -> db : Match statistics
----

**Contained Building Blocks (Internal):**

[cols="1,2" options="header"]
|===
| **Name** | **Responsibility**
| Auth Service | (Node.js) Manages user identity, registration, and security.
| Game Engine | (Rust) Handles the core rules and hexagonal grid logic for Game Y.
| Stats Service | Aggregates data for leaderboards and user win/loss history.
|===

---
==== Auth Service
**Purpose/Responsibility:**
Handles user registration, authentication, and session management. It issues JWT (JSON Web Tokens) for secure access to other services.

**Interface(s):**
* **HTTP POST /register:** Creates new user accounts.
* **HTTP POST /login:** Validates credentials and returns a token.

**Directory/File Location:**
`./apps/backend/services/auth`

==== Game Engine (Rust)
**Purpose/Responsibility:**
The core of the system. It handles the Game Y logic, validates hexagonal grid moves, and calculates win/loss conditions. Built in Rust for high performance.

**Interface(s):**
* **Rust-Node Bridge:** Internal API for receiving game moves and returning states.

**Directory/File Location:**
`./apps/backend/services/game-engine`

==== Statistics Service
**Purpose/Responsibility:**
Calculates and updates user rankings and match history. It processes data asynchronously to ensure the game remains responsive.

**Directory/File Location:**
`./apps/backend/services/stats`

=== Level 3: White Box of the Database

At this level, we describe how the data is structured within MongoDB to support the systemâ€™s requirements.

[plantuml, "level-3-diagram", svg]
----
database "MongoDB" {
    folder "Collections" {
        [Users]
        [Matches]
        [Statistics]
    }
}
----

==== Users Collection
**Purpose/Responsibility:** Stores unique user profiles and secure authentication data. It ensures each player has a persistent identity within the WIQ System.

* **`username`**: Unique identifier for the user.
* **`password`**: Salted and hashed using BCrypt for security.
* **`email`**: Used for account recovery and notifications.

**Directory/File Location:** `./data/db/users`

==== Matches Collection
**Purpose/Responsibility:** Maintains a persistent record of all games played, allowing for match history tracking and game state resumption.

* **`players`**: References to the Users collection for both participants.
* **`moves`**: Array of moves stored in **YEN notation** to recreate the game state.
* **`status`**: Indicates the current state of the game (Ongoing, Finished, or Draw).

**Directory/File Location:** `./data/db/matches`

==== Statistics Collection
**Purpose/Responsibility:** A pre-calculated and optimized collection used for generating the global leaderboard and user performance metrics. It is updated asynchronously by the Stats Service.


**Directory/File Location:** `./data/db/statistics`

// PR review test - Elif